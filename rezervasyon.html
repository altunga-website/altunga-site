<!DOCTYPE html>
<html lang="tr">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Rezervasyon</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      background: #fff;
      padding: 30px;
      max-width: 700px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 25px;
    }
    label {
      display: block;
      margin: 15px 0 5px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .accordion {
      background-color: #f4f4f4;
      color: #444;
      cursor: pointer;
      padding: 15px;
      width: 100%;
      border: 1px solid #ccc;
      text-align: left;
      outline: none;
      font-size: 16px;
      transition: 0.4s;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .accordion:hover {
      background-color: #28a745;
      color: white;
    }
    .accordion:after {
      content: '\002B';
      float: right;
    }
    .active:after {
      content: "\2212";
    }
    .panel {
      padding: 10px 18px;
      background-color: #f9f9f9;
      display: none;
      overflow: hidden;
      border-left: 3px solid #28a745;
    }
    .kart-grup {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .kart {
      background-color: #f4f4f4;
      padding: 5px;
      border: 2px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
    }
    .kart:hover,
    .kart.selected {
      background-color: #28a745;
      border-color: #218838;
      color: white;
    }
    button {
      background-color: #28a745;
      color: white;
      padding: 12px;
      border: none;
      width: 100%;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    #message {
      display: none;
      padding: 10px;
      border-radius: 5px;
      margin-top: 20px;
      text-align: center;
    }
	@media (max-width: 600px) {
  .accordion {
    font-size: 14px;
    padding: 10px;
  }
}
@media (max-width: 600px) {
  .kart-grup {
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }
}
@media (max-width: 600px) {
  input, select, button {
    font-size: 14px;
    padding: 8px;
  }
}
@media (max-width: 600px) {
  .container {
    padding: 15px;
    margin: 10px;
  }
}


  </style>
</head>
<body>

  <div class="container">
  <div style="display:flex; justify-content:center; margin-bottom:20px;">
  <img src="logo.png" alt="Logo" style="max-width:150px; height:auto;">
</div>
    <h1>Online Rezervasyon Formu</h1>
    <form id="rezervasyonForm">
      <label for="isim">Ad Soyad</label>
      <input type="text" id="isim" required>

      <label for="tc">T.C. Kimlik No</label>
      <input type="text" id="tc" maxlength="11" required>

      <button type="button" class="accordion">Karaoke Odaları</button>
      <div class="panel">
        <div class="kart-grup">
          <div class="kart" data-alan="karaoke_1">Karaoke 1</div>
          <div class="kart" data-alan="karaoke_2">Karaoke 2</div>
          <div class="kart" data-alan="karaoke_3">Karaoke 3</div>
          <div class="kart" data-alan="karaoke_4">Karaoke 4</div>
        </div>
      </div>

      <button type="button" class="accordion">Simülasyon Alanları</button>
      <div class="panel">
        <div class="kart-grup">
          <div class="kart" data-alan="simulasyon_1">Simulasyon 1</div>
          <div class="kart" data-alan="simulasyon_2">Simulasyon 2</div>
          <div class="kart" data-alan="simulasyon_3">Simulasyon 3</div>
          <div class="kart" data-alan="simulasyon_4">Simulasyon 4</div>
          <div class="kart" data-alan="simulasyon_5">Simulasyon 5</div>
          <div class="kart" data-alan="simulasyon_6">Simulasyon 6</div>
          <div class="kart" data-alan="simulasyon_7">Simulasyon 7</div>
          <div class="kart" data-alan="simulasyon_8">Simulasyon 8</div>
          <div class="kart" data-alan="simulasyon_9">Simulasyon 9</div>
          <div class="kart" data-alan="simulasyon_10">Simulasyon 10</div>
          <div class="kart" data-alan="simulasyon_11">Simulasyon 11</div>
        </div>
      </div>

      <button type="button" class="accordion">VIP Simulasyon</button>
      <div class="panel">
        <div class="kart-grup">
          <div class="kart" data-alan="vip_simulasyon_12">VIP Simulasyon 12</div>
          <div class="kart" data-alan="vip_simulasyon_13">VIP Simulasyon 13</div>
          <div class="kart" data-alan="vip_simulasyon_14">VIP Simulasyon 14</div>
          <div class="kart" data-alan="vip_simulasyon_15">VIP Simulasyon 15</div>
          <div class="kart" data-alan="vip_simulasyon_16">VIP Simulasyon 16</div>
          <div class="kart" data-alan="vip_simulasyon_17">VIP Simulasyon 17</div>
          <div class="kart" data-alan="vip_simulasyon_18">VIP Simulasyon 18</div>
          <div class="kart" data-alan="vip_simulasyon_19">VIP Simulasyon 19</div>
          <div class="kart" data-alan="vip_simulasyon_20">VIP Simulasyon 20</div>
        </div>
      </div>

      <button type="button" class="accordion">VIP Playstation</button>
      <div class="panel">
        <div class="kart-grup">
          <div class="kart" data-alan="vip_playstation_1">VIP Playstation 1</div>
          <div class="kart" data-alan="vip_playstation_2">VIP Playstation 2</div>
          <div class="kart" data-alan="vip_playstation_3">VIP Playstation 3</div>
          <div class="kart" data-alan="vip_playstation_4">VIP Playstation 4</div>
          <div class="kart" data-alan="vip_playstation_5">VIP Playstation 5</div>
          <div class="kart" data-alan="vip_playstation_6">VIP Playstation 6</div>
          <div class="kart" data-alan="vip_playstation_7">VIP Playstation 7</div>
          <div class="kart" data-alan="vip_playstation_8">VIP Playstation 8</div>
        </div>
      </div>

      <input type="hidden" id="seciliAlan">

      <label for="tarih">Tarih</label>
      <input type="date" id="tarih" required>
<label for="sure">Süre (saat)</label>
<select id="sure" required>
  <option value="1">1 Saat</option>
  <option value="2">2 Saat</option>
  <option value="3">3 Saat</option>
</select>

      <label for="saat">Saat</label>
      <select id="saat" required></select>

      <button type="submit">Rezervasyon Yap</button>
    </form>
    <div id="message"></div>
  </div>
 <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC2kYwYuv7drDw0zViXYN4DqpppbtP_coY",
    authDomain: "altunga-siparis.firebaseapp.com",
    projectId: "altunga-siparis"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Accordion işlevi
  document.querySelectorAll('.accordion').forEach(button => {
    button.addEventListener('click', function () {
      this.classList.toggle("active");
      const panel = this.nextElementSibling;
      panel.style.display = panel.style.display === "block" ? "none" : "block";
    });
  });

  // Kart seçimi
  document.querySelectorAll('.kart').forEach(kart => {
    kart.addEventListener('click', function () {
      document.querySelectorAll('.kart').forEach(k => k.classList.remove('selected'));
      kart.classList.add('selected');
      document.getElementById('seciliAlan').value = kart.dataset.alan;
    });
  });

  // Tarih değişimi (sadece son değişiklikte çalışsın diye debounce eklendi)
  let tarihTimer;
  const tarihInput = document.getElementById('tarih');
  tarihInput.addEventListener('input', () => {
    clearTimeout(tarihTimer);
    tarihTimer = setTimeout(() => {
      const tarihStr = tarihInput.value;
      const alanId = document.getElementById('seciliAlan').value;
      if (!alanId || !/^\d{4}-\d{2}-\d{2}$/.test(tarihStr)) return;
      saatSecenekleriniYukle(alanId, tarihStr);
    }, 300); // 300ms bekleyip öyle çağır
  });

  let isLoadingSaatler = false;

  async function saatSecenekleriniYukle(alanId, tarihStr) {
  if (isLoadingSaatler) return;
  isLoadingSaatler = true;

  const sure = parseInt(document.getElementById("sure")?.value || "1");

  const saatSecimi = document.getElementById("saat");
  saatSecimi.innerHTML = "";

  const saatler = [
    "12:00", "13:00", "14:00", "15:00", "16:00",
    "17:00", "18:00", "19:00", "20:00", "21:00",
    "22:00", "23:00"
  ];

  for (let i = 0; i <= saatler.length - sure; i++) {
    let doluVar = false;
    const saatBloğu = saatler.slice(i, i + sure);

    for (const saat of saatBloğu) {
      const ref = doc(db, "alanlar", alanId, "rezervasyonlar", tarihStr, saat, "veri");
      const docSnap = await getDoc(ref);
      if (docSnap.exists() && docSnap.data().durum?.toLowerCase() === "dolu") {
        doluVar = true;
        break;
      }
    }

    const option = document.createElement("option");
    option.value = saatler[i];
    option.textContent = doluVar ? `${saatler[i]} (Dolu)` : saatler[i];
    option.disabled = doluVar;
    if (doluVar) {
      option.style.color = "#999";
      option.style.fontStyle = "italic";
    }
    saatSecimi.appendChild(option);
  }

  isLoadingSaatler = false;
}

  function isValidDateFormat(tarihStr) {
    return /^\d{4}-\d{2}-\d{2}$/.test(tarihStr);
  }

  document.getElementById('rezervasyonForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const isim = document.getElementById('isim').value;
  const tc = document.getElementById('tc').value;
  const alan = document.getElementById('seciliAlan').value;
  const tarih = document.getElementById('tarih').value;
  const saat = document.getElementById('saat').value;
  const sure = parseInt(document.getElementById('sure').value);

  if (!alan || !tarih || !saat || !sure) {
    return showMessage("Lütfen tüm alanları doldurunuz", "error");
  }

  const saatler = [
    "12:00", "13:00", "14:00", "15:00", "16:00",
    "17:00", "18:00", "19:00", "20:00", "21:00",
    "22:00", "23:00"
  ];
  const saatIndex = saatler.indexOf(saat);
  const secilenSaatler = saatler.slice(saatIndex, saatIndex + sure);

  for (const s of secilenSaatler) {
    const ref = doc(db, "alanlar", alan, "rezervasyonlar", tarih, s, "veri");
    const snap = await getDoc(ref);
    if (snap.exists() && snap.data().durum?.toLowerCase() === "dolu") {
      return showMessage(`Seçtiğiniz saat aralığında (${s}) dolu bir rezervasyon var`, "error");
    }
  }

  for (const s of secilenSaatler) {
    const ref = doc(db, "alanlar", alan, "rezervasyonlar", tarih, s, "veri");
    await setDoc(ref, {
      alan,
      isim,
      tc,
      durum: "dolu"
    });
  }

  showMessage("Rezervasyon başarıyla yapıldı", "success");
  const seciliAlan = document.getElementById("seciliAlan").value;
  document.getElementById("rezervasyonForm").reset();
  document.getElementById("seciliAlan").value = seciliAlan;

  if (tarih && seciliAlan) {
    await saatSecenekleriniYukle(seciliAlan, tarih);
  }
});


  function showMessage(msg, type) {
    const div = document.getElementById("message");
    div.innerText = msg;
    div.style.display = "block";
    div.style.backgroundColor = type === "success" ? "#28a745" : "#dc3545";
    div.style.color = "white";
  }
  
</script>
</body>
</html>
