<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Altunga Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg-body: #f1f5f9; --sidebar-bg: #ffffff; --card-bg: #ffffff;
            --border-color: #e2e8f0; --text-main: #1e293b; --text-muted: #64748b;
            --primary: #3b82f6; --accent: #10b981; --danger: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); --input-bg: #f8fafc;
        }
        body.dark-mode {
            --bg-body: #0f172a; --sidebar-bg: #1e293b; --card-bg: #1e293b;
            --border-color: #334155; --text-main: #f1f5f9; --text-muted: #94a3b8;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); --input-bg: rgba(0,0,0,0.3);
        }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; padding: 0; background-color: var(--bg-body); color: var(--text-main); font-family: 'Poppins', sans-serif; height: 100vh; overflow: hidden; transition: 0.3s; }

        /* Login */
        #login-screen { position: fixed; inset: 0; background: var(--bg-body); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: var(--card-bg); padding: 40px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; border: 1px solid var(--border-color); box-shadow: var(--shadow); }
        .modern-input { width: 100%; padding: 12px; margin: 10px 0; background: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-main); border-radius: 8px; font-family: inherit; }
        .modern-btn { width: 100%; padding: 12px; background: var(--primary); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: 600; }

        /* Dashboard Layout */
        .dashboard-container { display: none; height: 100vh; width: 100vw; }
        .sidebar { width: 260px; background: var(--sidebar-bg); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .brand { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        
        .add-btn { background: rgba(16, 185, 129, 0.1); color: var(--accent); border: 1px dashed var(--accent); width: 100%; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; margin-bottom: 15px; text-align:center; }
        .add-btn:hover { background: var(--accent); color: white; }
        
        .category-list { list-style: none; padding: 0; margin: 0; flex: 1; overflow-y: auto; }
        .cat-btn { width: 100%; padding: 12px 15px; margin-bottom: 5px; background: transparent; border: 1px solid transparent; color: var(--text-muted); border-radius: 8px; cursor: pointer; text-align: left; font-weight: 500; }
        .cat-btn:hover { background: rgba(59, 130, 246, 0.1); color: var(--primary); }
        .cat-btn.active { background: rgba(59, 130, 246, 0.15); color: var(--primary); border-color: rgba(59, 130, 246, 0.3); font-weight: 600; }
        
        .sidebar-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 10px; }
        .theme-btn { background: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-main); padding: 10px; border-radius: 8px; cursor: pointer; }

        .main-content { flex: 1; padding: 20px; overflow-y: auto; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .search-input { width: 100%; max-width: 400px; padding: 12px 15px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-main); }

        /* --- KART YAPISI (D√úZELTƒ∞LDƒ∞) --- */
        .product-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
            gap: 20px; 
            padding-bottom: 50px; 
        }
        
        .product-card { 
            background: var(--card-bg); 
            border: 1px solid var(--border-color); 
            border-radius: 16px; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; /* Elemanlar arasƒ± bo≈üluk */
            box-shadow: var(--shadow);
            height: 100%;
        }

        .p-header { 
            display: flex; 
            gap: 15px; 
            align-items: center; 
        }
        
        .p-img { 
            width: 60px; 
            height: 60px; 
            object-fit: contain; 
            background: var(--input-bg); 
            border-radius: 10px; 
            padding: 5px; 
            flex-shrink: 0;
        }
        
        .p-info { 
            flex: 1; 
            overflow: hidden; 
        }
        .p-info h4 { margin: 0 0 5px 0; font-size: 0.95rem; color: var(--text-main); }
        .p-info span { font-size: 0.8rem; color: var(--text-muted); display: block; }

        .p-footer { 
            margin-top: auto; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }
        
        /* Fiyat Alanƒ± */
        .price-wrap { 
            display: flex; align-items: center; background: var(--input-bg); 
            padding: 5px 10px; border-radius: 8px; border: 1px solid var(--border-color);
        }
        .price-inp { 
            background: transparent; border: none; color: var(--accent); 
            font-weight: 700; width: 50px; text-align: center; font-size: 1rem; 
        }

        /* Butonlar Grubu */
        .action-btns { 
            display: flex; 
            gap: 8px; 
        }
        
        .icon-btn { 
            width: 36px; height: 36px; 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            cursor: pointer; 
            display: flex; align-items: center; justify-content: center;
            background: var(--card-bg); font-size: 1.1rem;
            transition: 0.2s;
        }
        
        /* Pop√ºler Butonu */
        .btn-pop { color: #94a3b8; }
        .btn-pop.active { background: #fee2e2; color: #ef4444; border-color: #ef4444; }
        .btn-pop:hover { background: #f1f5f9; }

        /* Sil Butonu */
        .btn-del { color: var(--danger); }
        .btn-del:hover { background: #fee2e2; border-color: var(--danger); }

        /* Kaydet Butonu */
        .btn-save { 
            background: var(--primary); color: white; border: none;
            padding: 0 15px; font-weight: 600; font-size: 0.85rem;
            border-radius: 8px; cursor: pointer;
        }
        .btn-save:hover { opacity: 0.9; }

        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 10000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        .modal-box { background: var(--card-bg); width: 90%; max-width: 400px; padding: 25px; border-radius: 20px; border: 1px solid var(--border-color); box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-size: 0.85rem; color: var(--text-muted); }

        @media (max-width: 768px) {
            .dashboard-container { flex-direction: column; }
            .sidebar { width: 100%; padding: 10px; height: auto; border-right: none; border-bottom: 1px solid var(--border-color); }
            .brand, .sidebar-footer { display: none; }
            .category-list { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
            .cat-btn { white-space: nowrap; width: auto; }
            .add-btn { width: auto; margin: 0; padding: 10px 20px; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2>Y√∂netici Giri≈üi</h2>
            <input type="email" id="email" class="modern-input" placeholder="E-Posta" value="kasiyer@altunga.com">
            <input type="password" id="password" class="modern-input" placeholder="≈ûifre">
            <button class="modern-btn" onclick="login()">Giri≈ü Yap</button>
            <p id="loginMsg" style="color: var(--danger); font-size: 0.8rem; margin-top:10px;"></p>
        </div>
    </div>

    <div id="addModal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0; color:var(--text-main)">Yeni √úr√ºn Ekle</h3>
            <div class="form-group"><label class="form-label">Kategori</label><select id="newCatSelect" class="modern-input" onchange="checkNewCategory(this)"></select><input type="text" id="newCatInput" class="modern-input" placeholder="Yeni Kategori" style="display:none; margin-top:5px; border-color:var(--accent);"></div>
            <div class="form-group"><label class="form-label">Grup</label><input type="text" id="newGroup" class="modern-input" placeholder="√ñrn: Gazlƒ± ƒ∞√ßecekler"></div>
            <div class="form-group"><label class="form-label">√úr√ºn Adƒ±</label><input type="text" id="newName" class="modern-input" placeholder="√ñrn: Yeni Cola"></div>
            <div class="form-group"><label class="form-label">Fiyat</label><input type="number" id="newPrice" class="modern-input" placeholder="0"></div>
            <div class="form-group"><label class="form-label">Resim URL</label><input type="text" id="newImg" class="modern-input" placeholder="https://..."></div>
            <div class="form-group" style="display:flex; align-items:center; gap:10px; cursor:pointer;" onclick="document.getElementById('newPop').click()">
                <input type="checkbox" id="newPop" style="transform:scale(1.5);">
                <label class="form-label" style="margin:0; cursor:pointer;">üî• Pop√ºler (Vitrine Ekle)</label>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="modern-btn" onclick="saveNewProduct()" style="background: var(--accent);">Kaydet</button>
                <button class="modern-btn" onclick="closeModal()" style="background: var(--text-muted);">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <div class="dashboard-container" id="dashboard">
        <aside class="sidebar">
            <div class="brand">üéõÔ∏è Altunga Panel</div>
            <button class="add-btn" onclick="openModal()">+ Yeni √úr√ºn</button>
            <ul class="category-list" id="categoryList"></ul>
            <div class="sidebar-footer">
                <button class="theme-btn" onclick="toggleTheme()" id="themeBtn">üåô Karanlƒ±k Mod</button>
                <button onclick="logout()" style="background:transparent; border:1px solid var(--danger); color:var(--danger); padding:10px; border-radius:8px; cursor:pointer;">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <input type="text" class="search-input" id="search" placeholder="√úr√ºn ara..." onkeyup="searchProduct()">
                <div id="itemCount" style="color: var(--text-muted); font-size: 0.9rem;"></div>
            </div>
            <div id="loading" style="text-align:center; margin-top:50px; color:var(--text-muted);">Y√ºkleniyor...</div>
            <div class="product-grid" id="productGrid"></div>
        </main>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC2kYwYuv7drDw0zViXYN4DqpppbtP_coY",
            authDomain: "altunga-siparis.firebaseapp.com",
            databaseURL: "https://altunga-siparis-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "altunga-siparis",
            storageBucket: "altunga-siparis.appspot.com",
            messagingSenderId: "152830720353",
            appId: "1:152830720353:web:cc3d3646e6a859c0ca2d20",
            measurementId: "G-JKXK55E39H"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let allProducts = [];
        let categories = new Set();
        let currentCategory = "T√ºm√º";

        const exactImageMap = { "Su 500ml": "urunimg/su.png", "Coca Cola C.≈ûi≈üe 200ml.": "urunimg/cola200.png", "Coca Cola C.≈ûi≈üe 300ml.": "urunimg/sise300.png", "Coca Cola 330ml.": "urunimg/kutukola.png", "Coca Cola Zero 330ml.": "urunimg/zeroc.png", "Coca Cola 1lt.": "urunimg/1ltcola.png", "Coca Cola 1lt. Light": "urunimg/1ltcolalight.png", "Coca Cola 2,5lt.": "urunimg/2,5litre.png", "Fanta C.≈ûi≈üe 200ml.": "urunimg/fanta200cam.png", "Fanta 330ml.": "urunimg/fanta330.png", "Fanta 1lt.": "urunimg/fanta1lt.png", "Sprite 330ml.": "urunimg/sprite330.png", "Cola Turka 200ml.": "urunimg/colaturka200.png", "Av≈üar Doƒüal": "urunimg/avsarnatural.png", "Av≈üar Limonlu": "urunimg/avsarlimon.png", "Av≈üar Mango & Ananas": "urunimg/avsarmango.png", "Av≈üar Karpuz & √áilek": "urunimg/avsarkarpuz.png", "Av≈üar Karadut & Frenk √úz√ºm√º": "urunimg/avsarkaradut.png", "Av≈üar D√º≈ües Armudu": "urunimg/avsarduses.png", "Damla Minera Sade": "urunimg/damlasade.png", "Damla Minera Limonlu": "urunimg/damlalimon.png", "Damla √áilekli & Karpuzlu": "urunimg/damlacilek.png", "Damla Mango & Ananas": "urunimg/damlamango.png", "Damla Elmalƒ±": "urunimg/damlaelmali.png", "Damla Minera 330ml.": "urunimg/damla330.png", "Karpuz & √áilek": "urunimg/fresacilek.png", "Limon": "urunimg/fresalimon.png", "√áilek": "urunimg/fresakarpuz.png", "Beypazarƒ± Sade": "urunimg/beypazari.png", "Red Bull 250ml.": "urunimg/redbull250.png", "Red Bull Peach E. 250ml.": "urunimg/redbullpeach.png", "Red Bull Yellow E. 250ml.": "urunimg/redbullyellow.png", "Red Bull White E. 250ml.": "urunimg/redbullwhite.png", "Red Bull Pink E. 250ml.": "urunimg/redbullpink.png", "Red Bull Red E. 250ml.": "urunimg/redbullred.png", "Red Bull Sugar E. 250ml.": "urunimg/redbullsugar.png", "Red Bull Blue E. 250ml.": "urunimg/redbullblue.png", "Red Bull Klasik 355ml.": "urunimg/redbull355.png", "Monster Klasik 500ml.": "urunimg/monster500.png", "Monster U.Tropikal 500ml.": "urunimg/monsterutropical.png", "Monster Pipeline P. 500ml.": "urunimg/monsterpipeline.png", "Monster The Doctor S. 500ml.": "urunimg/monsterthedoctor.png", "Monster Watermelon 500ml.": "urunimg/monsterwatermelon.png", "Monster R.W. Pineapple 500ml.": "urunimg/monsterpineapple.png", "Monster U.Sunrise 500ml.": "urunimg/monstersunrise.png", "Monster Mango Loco 500ml.": "urunimg/monstermango.png", "Monster Ultra White 500ml.": "urunimg/monsterultra.png", "Burn Original 250ml.": "urunimg/burn250.png", "Burn Gold Spark 250ml.": "urunimg/burngold.png", "Burn Zero Sugar 250ml.": "urunimg/burnzero.png", "Burn 500ml.": "urunimg/burn500.png", "Powerade Ice Blast 500ml.": "urunimg/poweradeice.png", "Powerade Sun Brush 500ml.": "urunimg/poweradesun.png", "Fusetea ≈ûeftali 330ml.": "urunimg/fuseteaseftali.png", "Fusetea Limon 330ml.": "urunimg/fusetealimon.png", "Fusetea Frambuaz & B√∂ƒü√ºrtlen 330ml.": "urunimg/fuseteabogurtlen.png", "Fusetea Mango & Ananas 330ml.": "urunimg/fuseteamango.png", "Fusetea Karpuz 330ml.": "urunimg/fuseteakarpuz.png", "Fusetea Kavun & √áilek 330ml.": "urunimg/fuseteakavun.png", "Fusetea ≈ûeftali 1lt.": "urunimg/fuseteaseftali1lt.png", "Fusetea Karpuz 1lt.": "urunimg/fuseteakarpuz1lt.png", "Fusetea Limon 1lt.": "urunimg/fusetealimon1lt.png", "Fusetea Mango & Ananas 1lt.": "urunimg/fuseteamango1lt.png", "Fusetea Kavun & √áilek 1lt.": "urunimg/fuseteakavun1lt.png", "Fusetea Ejder Meyveli 1lt.": "urunimg/fuseteaejder.png", "Didi ≈ûeftali 330ml.": "urunimg/didiseftali.png", "Didi Limon 330ml.": "urunimg/didilimon.png", "Didi Bergamot 330ml.": "urunimg/didibergamot.png", "Obsesson Latte S√ºtl√º 250ml.": "urunimg/obsessolattesutlu.png", "Obsesson Caramel Macchiato 250ml.": "urunimg/obsessocaramel.png", "Nescafe Xpress L. Original 250ml.": "urunimg/nescafeorijinal.png", "Nescafe Black Roast 250ml.": "urunimg/nescafeblack.png", "Cappy Vi≈üne 330ml.": "urunimg/cappyvisne.png", "Cappy Portakal 330ml.": "urunimg/cappyportakal.png", "Cappy Atom - Ballƒ± K. 330ml.": "urunimg/cappyatom.png", "Caprisun Multivitamin 200ml.": "urunimg/caprisunmulti.png", "Caprisun Safari 200ml.": "urunimg/caprisunsafari.png", "Caprisun Mystic Dragon 200ml.": "urunimg/caprisundragon.png", "Link √áilekli 200ml.": "urunimg/linkcilekli.png", "Original 20gr.": "urunimg/rufflesoriginal.png", "Original 50gr.": "urunimg/rufflesoriginal.png", "Original Orta Boy 88gr.": "urunimg/rufflesoriginal.png", "Original Orta Boy 105gr.": "urunimg/rufflesoriginal.png", "Original B√ºy√ºk Boy 160gr.": "urunimg/rufflesoriginal.png", "Original Mega Boy 193gr.": "urunimg/rufflesoriginalmega.png", "Ket√ßaplƒ± 50gr.": "urunimg/rufflesketcap.png", "Ket√ßaplƒ± Orta Boy 105gr.": "urunimg/rufflesketcap.png", "Ket√ßaplƒ± B√ºy√ºk Boy 160gr.": "urunimg/rufflesketcap.png", "Peynir & Soƒüan Orta Boy 105gr.": "urunimg/rufflespeynir.png", "Peynir & Soƒüan B√ºy√ºk Boy 160gr.": "urunimg/rufflespeynir.png", "Mangalda Orta Boy 105gr.": "urunimg/rufflesmangalda.png", "Deƒüi≈ü Toku≈ü Orta Boy 105gr.": "urunimg/rufflesdegis.png", "Lays Yoƒüurt ve Mevsim Ye≈üil. K√º√ß√ºk Boy 50gr.": "urunimg/laysyogurttan.png", "Lays Klasik K√º√ß√ºk Boy 50gr.": "urunimg/laysklasik50.png", "Lays Klasik Orta Boy 107gr.": "urunimg/laysklasik107.png", "Lays Fƒ±rƒ±ndan Orta Boy 92gr.": "urunimg/laysfirindan.png", "Lays Fƒ±rƒ±ndan B√ºy√ºk Boy 134gr.": "urunimg/laysfirindan.png", "Lays Baharatlƒ± Orta Boy 105gr.": "urunimg/laysbaharatli.png", "Lays Yoƒüurt ve Mevsim Ye≈üil. Orta Boy 105gr.": "urunimg/laysyogurttan.png", "Lays Yoƒüurt ve Mevsim Ye≈üil. B√ºy√ºk Boy 160gr.": "urunimg/laysyogurttan.png", "Lays Baharatlƒ± B√ºy√ºk Boy 160gr.": "urunimg/laysbaharatli.png", "Lays Klasik B√ºy√ºk Boy 160gr.": "urunimg/laysklasik.png", "Doritos Shoots Mexicano - Acƒ± (30gr.": "urunimg/doritosshootsmexicano.png", "Doritos Shoots 30gr.": "urunimg/doritosshoots.png", "Doritos Tako K√º√ß√ºk Boy 53gr.": "urunimg/doritostaco.png", "Doritos Hot Corn Acƒ± B. K√º√ß√ºk Boy 53gr.": "urunimg/doritoshotcorn.png", "Doritos Hot Corn B√ºy√ºk Boy 180gr.": "urunimg/doritoshotcorn.png", "Doritos Tako Orta Boy 114gr.": "urunimg/doritostaco.png", "Doritos Tako B√ºy√ºk Boy 185gr.": "urunimg/doritostaco.png", "Doritos Nacho P. Orta Boy 109gr.": "urunimg/doritosnacho.png", "Doritos Nacho P. B√ºy√ºk Boy 160gr.": "urunimg/doritosnacho.png", "Doritos Tako Mega Boy 193gr.": "urunimg/doritostaco.png", "Doritos Extreme Mex. Orta Boy 109gr.": "urunimg/doritosextreme.png", "Doritos Flamin Hot Orta Boy 102gr.": "urunimg/doritosflamin.png", "Doritos Turca S√ºper Boy 109gr.": "urunimg/doritosturca.png", "Doritos Deƒüi≈ü Toku≈ü 115gr.": "urunimg/doritosswap.png", "√áerezza Kokteyl Baharatlƒ± Orta Boy 117 gr.": "urunimg/cerezzakokteyl.png", "√áerezza Sinema Pey.Soƒü. Orta Boy 121 gr.": "urunimg/cerezzasinema.png", "√áerezza S√ºt Mƒ±sƒ±rƒ± Orta Boy 121 gr.": "urunimg/cerezzamisir.png", "√áerezza Popcorn Orta Boy 80 gr.": "urunimg/cerezzapopcorn.png", "√áerezza Acƒ±lƒ± S√ºper Boy 117 gr.": "urunimg/cerezzaacili.png", "√áerezza Dev Bah. Dom. Soslu 150 gr.": "urunimg/cerezzadev.png", "√áerezza Dev Yer. Fƒ±s. B√ºy√ºk Boy 145 gr.": "urunimg/cerezzadevyer.png", "Cheetos Biftek & Soƒüan 43gr.": "urunimg/cheetos.png", "Cheetos Biftek & Soƒüan 23gr.": "urunimg/cheetosshoots.png", "Gong Peynir ve Acƒ±lƒ± M. Patlaƒüƒ±": "urunimg/gongaci.png", "Gong Bal ve Hardallƒ± M. Patlaƒüƒ±": "urunimg/gongbal.png", "Gong Orijinal Lezzet": "urunimg/gongoriginal.png", "Gong Pops Bal ve Hardallƒ± M. Patlaƒüƒ±": "urunimg/gongpopsbal.png", "Gong Pops Taco": "urunimg/gongpopstaco.png", "Haylayf": "urunimg/haylayf.png", "√áizi Peynirli": "urunimg/cizipeynirli.png", "√áizivi√ß Peynirli": "urunimg/cizipeynir.png", "ƒ∞kram √áikolatalƒ±": "urunimg/ikramcikolatali.png", "ƒ∞kram Fƒ±ndƒ±klƒ±": "urunimg/ikramfindik.png", "Hanƒ±meller Fƒ±ndƒ±klƒ±": "urunimg/hanimellerfindikli.png", "Hanƒ±meller √áoko Damla": "urunimg/hanimellercokodam.png", "Biskrem": "urunimg/biskrem.png", "Halley": "urunimg/halleyy.png", "Hanƒ±meller Frambuazlƒ±": "urunimg/hanimellerframbuaz.png", "Biskrem Cookie": "urunimg/biskremcookie.png", "Halley Karadutlu": "urunimg/halleykaradut.png", "Probis": "urunimg/probis.png", "Cocostar Atƒ±≈ütƒ±rmalƒ±k": "urunimg/cocostaratistirmalik.png", "Tutku": "urunimg/tutku.png", "Benim'o Bitter": "urunimg/benimobitter.png", "Benim'o √áikolatalƒ±": "urunimg/benimociko.png", "Nero": "urunimg/nero.png", "Cin": "urunimg/cin.png", "Canga": "urunimg/canga.png", "Petito Gofret": "urunimg/petitogofret.png", "Maximus Loading XL": "urunimg/maximusloadingxl.png", "Ho≈übe≈ü Kakaolu": "urunimg/hosbeskakao.png", "Maximus": "urunimg/maximus36.png", "Karam": "urunimg/karamgurme.png", "Petito Patim": "urunimg/petitopatim.png", "Petito Mini": "urunimg/petitomini.png", "Maximus √áilekli": "urunimg/maximuscilekli.png", "Canga Antep Fƒ±stƒ±klƒ±": "urunimg/cangaantep.png", "Maximus Muzlu": "urunimg/maximusmuzlu.png", "Ho≈übe≈ü Fƒ±ndƒ±klƒ±": "urunimg/hosbesfindikli.png", "Caramio Karamel": "urunimg/caramiokaramel.png", "√áokonat Antep Fƒ±stƒ±klƒ±": "urunimg/cokonatfindikli.png", "Olala Tiramisu": "urunimg/olalatramisu.png", "Olala Bold": "urunimg/olalabold.png", "9 Kat Tat Muzlu": "urunimg/9katmuzlu.png", "9 Kat Tat Fƒ±ndƒ±klƒ±": "urunimg/9katfindikli.png", "9 Kat Tat Portakallƒ±": "urunimg/9katportakal.png", "√áokonat": "urunimg/cokonat.png", "Dido S√ºtl√º √áikolatalƒ±": "urunimg/didosutluciko.png", "Coco Star": "urunimg/cocostar1.png", "Laviva": "urunimg/laviva.png", "Rulokat": "urunimg/rulokat.png", "Piko": "urunimg/piko.png", "Dido Frambuazlƒ±": "urunimg/didoframbuaz.png", "Dido Trio": "urunimg/didotrioo.png", "Dido Trio Colors √áilekli": "urunimg/didotrio.png", "Dido Gold": "urunimg/didogold.png", "Fƒ±ndƒ±k R√ºyasƒ±": "urunimg/findikruyasi.png", "√áokomel": "urunimg/cokomel.png", "Harby Karamelli": "urunimg/harbykaramel.png", "Harby S√ºtl√º": "urunimg/harbysutlu.png", "3GEN Beyaz": "urunimg/3genbeyaz.png", "Popkek Muzlu": "urunimg/popkekmuz.png", "Popkek √áikolatalƒ±": "urunimg/popkekciko.png", "Popkek Limonlu": "urunimg/popkeklimonlu.png", "Popkek Vi≈üneli": "urunimg/popkekvisneli.png", "Popkek Portakal": "urunimg/popkekportakal.png", "Popkek Bitter": "urunimg/popkekbitter.png", "Popkek Hindistan Cevizli": "urunimg/popkekcoconut.png", "Browni Gold √áikolatalƒ±": "urunimg/brownigold.png", "Browni Gold Vi≈üneli": "urunimg/brownigoldvisneli.png", "Browni ƒ∞ntense Gold Karamel": "urunimg/browniintense.png", "Browni ƒ∞ntense Gold √áikolatalƒ±": "urunimg/browniintenseciko.png", "S√ºtburger S√ºtl√º & √áilekli": "urunimg/sutburgercilekli.png", "S√ºtburger S√ºtl√º & Ballƒ±": "urunimg/sutburgerballi.png", "Dankek Mousse": "urunimg/dankekmousse.png", "8 Kek Muzlu": "urunimg/8kekmuzlu.png", "8 Kek Orman Meyveli": "urunimg/8kekorman.png", "8 Kek √áilekli": "urunimg/8kekcilek.png", "8 Kek √áikolatalƒ±": "urunimg/8kekcikolatali.png", "Kekstra J√∂le Bol": "urunimg/kekstrajolebol.png", "√áubuk Kraker": "urunimg/kraker.png", "Susamlƒ± √áubuk Kraker": "urunimg/susamlikraker.png", "Krispi Acƒ±lƒ±": "urunimg/krispiacili.png", "Krispi Baharatlƒ±": "urunimg/krispibaharatli.png", "Krispi Peynirli": "urunimg/krispipeynirli.png", "Ayƒ±cƒ±k": "urunimg/yupoayicik.png", "Solucan": "urunimg/yuposolucan.png", "Meyve Bah√ßesi": "urunimg/yupomeyvebahcesi.png", "Kola": "urunimg/yupokola.png", "Lokumcuk": "urunimg/lokum.png", "√áokojela Portakallƒ±": "urunimg/yupojelapor.png", "√áokojela B√∂ƒü√ºrtlen": "urunimg/yupojelabog.png", "Yupo Lolipop": "urunimg/yupololi.png", "Bonbon Nanelim": "urunimg/nanelim.png", "Portakal & Kivi": "urunimg/oneopor.png", "Nane & Kivi": "urunimg/oneonane.png", "Ye≈üil Nane": "urunimg/oneoyesilnane.png", "Karpuz": "urunimg/oneokarpuz.png", "√áilek": "urunimg/oneocilek.png", "Zencefil": "urunimg/zencefil.png", "Karam√ºrver": "urunimg/karamurver.png", "Okaliptus": "urunimg/okaliptus.png", "Ihlamur": "urunimg/ƒ±hlamur.png", "Lolipop": "urunimg/roccololipop.png", "Sƒ±kƒ±≈üeker Ahududu & Limon": "urunimg/roccoahududu.png", "Sƒ±kƒ±≈üeker Mandalina & Karpuz": "urunimg/roccomandalina.png", "Sƒ±kƒ±≈üeker Nar & √áilek": "urunimg/rocconar.png", "Stick Fruit Garden": "urunimg/jelly.png", "Patso Yeni": "urunimg/patso.png", "Sosisli Patso": "urunimg/patsososisli.png", "Patso Men√º (Patso + ≈û.Kola)": "urunimg/patsomenu.png", "Ka≈üarlƒ± Tost": "urunimg/kasarlitost.png", "Sucuklu Tost": "urunimg/sucuklutost.png", "Karƒ±≈üƒ±k Tost": "urunimg/karisiktost.png", "Tavuk D√∂ner 70gr.": "urunimg/tavukdoner.png", "Tavuk D√∂ner 90gr.": "urunimg/tavukdoner.png", "Tavuk D√∂ner 120gr.": "urunimg/tavukdoner.png", "Et D√∂ner 70gr.": "urunimg/etdoner.png", "Et D√∂ner 90gr.": "urunimg/etdoner.png", "Et D√∂ner 120gr.": "urunimg/etdoner.png", "Cornetto Disc Milka": "urunimg/cornettomilka.png", "Cornetto Disc Oreo": "urunimg/cornettooreo.png", "Cornetto Antep Fƒ±stƒ±klƒ±": "urunimg/cornettoantep.png", "Cornetto Vanilya Karamel": "urunimg/cornettovan.png", "Cornetto Mara≈ü Usul√º": "urunimg/cornettomarasusulu.png", "Cornetto Clas √áilek": "urunimg/cornettoclascilek.png", "Cornetto Disc Max Mango": "urunimg/cornettodiskmax.png", "Cornetto Disc Max √áikolatalƒ±": "urunimg/cornettodiscciko.png", "Cornetto Classico √áikolata": "urunimg/cornettoclassico.png", "Cornetto Classico Kaymak": "urunimg/cornettoclassicokaymak.png", "Cornetto Keyif": "urunimg/keyf.png", "Utopia Ahududu": "urunimg/utopia.png", "Utopia Karamel": "urunimg/utopiakaramel.png", "Classic": "urunimg/magnumclassic.png", "Beyaz": "urunimg/magnumbeyaz.png", "Badem": "urunimg/magnumbadem.png", "Double √áikolata": "urunimg/magnumdouble.png", "Double Karadut": "urunimg/magnumdoublekaradut.png", "Cookie": "urunimg/cookie.png", "Boom Boom": "urunimg/boomboom.png", "Boom Boom Gold": "urunimg/boomboomgold.png", "CL Frigola Bar PRM": "urunimg/frigola.png", "CL Classics Antep Fƒ±stƒ±k": "urunimg/clfistik.png", "CL Classics Kakao": "urunimg/clkakao.png", "Mara≈ü Cup": "urunimg/cup.png", "Nogger Sandwich": "urunimg/nogger.png", "Milka Stick": "urunimg/milkas.png", "Vienetta Stick": "urunimg/vienetta.png", "Volcano Stick": "urunimg/volcanostick.png", "Conboo Kakao": "urunimg/conboo.png", "Twister Forest": "urunimg/forest.png", "Twister Ocean": "urunimg/ocean.png", "Twister Cool": "urunimg/cool.png" };
        const catImages = { "ƒ∞√ßecekler": "icecekler.png", "Atƒ±≈ütƒ±rmalƒ±k": "cips.png", "≈ûekerleme": "jelibon.png", "Fast Food": "patso.png", "Dondurma": "dondurma.png", "D√∂ner": "doner.png", "Tost": "tost.png" };

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'flex';
                fetchData();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        function login() {
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value)
                .catch(() => document.getElementById('loginMsg').innerText = "Hatalƒ± Giri≈ü!");
        }
        function logout() { auth.signOut(); }

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeBtn').innerHTML = "‚òÄÔ∏è Aydƒ±nlƒ±k Mod";
        }
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('themeBtn').innerHTML = isDark ? "‚òÄÔ∏è Aydƒ±nlƒ±k Mod" : "üåô Karanlƒ±k Mod";
        }

        async function fetchData() {
            document.getElementById('loading').style.display = 'block';
            const snapshot = await db.collection("menu_items").orderBy("category").get();
            allProducts = [];
            categories = new Set();
            
            snapshot.forEach(doc => {
                const data = doc.data();
                allProducts.push({ id: doc.id, ...data });
                categories.add(data.category);
            });

            renderSidebar();
            renderProducts(currentCategory);
            document.getElementById('loading').style.display = 'none';
        }

        function renderSidebar() {
            const list = document.getElementById('categoryList');
            list.innerHTML = `<button class="cat-btn ${currentCategory === 'T√ºm√º' ? 'active' : ''}" onclick="filterCat('T√ºm√º', this)">üè† T√ºm√º</button>`;
            
            const icons = { "ƒ∞√ßecekler": "ü•§", "Atƒ±≈ütƒ±rmalƒ±k": "üçü", "≈ûekerleme": "üç¨", "Fast Food": "üçî", "D√∂ner": "ü•ô", "Dondurma": "üç¶", "Tost": "ü•™" };

            categories.forEach(cat => {
                list.innerHTML += `
                    <button class="cat-btn ${currentCategory === cat ? 'active' : ''}" onclick="filterCat('${cat}', this)">
                        ${icons[cat] || "üì¶"} ${cat}
                    </button>`;
            });
        }

        function filterCat(catName, btnElement) {
            currentCategory = catName;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');
            renderProducts(catName);
        }

        function renderProducts(filter) {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = "";
            let filteredList = allProducts;
            
            if (filter !== "T√ºm√º") filteredList = allProducts.filter(p => p.category === filter);
            
            const searchVal = document.getElementById('search').value.toLowerCase();
            if(searchVal) filteredList = filteredList.filter(p => p.name_tr.toLowerCase().includes(searchVal));

            document.getElementById('itemCount').innerText = `${filteredList.length} √ºr√ºn g√∂steriliyor`;

            filteredList.forEach(p => {
                // G√∂rsel: √ñnce DB, sonra Harita, sonra Kategori, en son Logo
                let imgSrc = p.image;
                if (!imgSrc || imgSrc === 'default.png' || imgSrc === '') {
                    imgSrc = exactImageMap[p.name_tr] || catImages[p.category.trim()] || 'logo.png';
                }

                // Butonun rengi: Pop√ºlerse kƒ±rmƒ±zƒ± (active), deƒüilse gri
                const popClass = p.isPopular ? 'active' : '';
                const popIcon = p.isPopular ? 'üî•' : '‚òÅÔ∏è';

                grid.innerHTML += `
                    <div class="product-card">
                        <div class="p-header">
                            <img src="${imgSrc}" class="p-img" onerror="this.src='logo.png'">
                            <div class="p-info">
                                <h4>${p.name_tr}</h4>
                                <span>${p.group}</span>
                            </div>
                        </div>
                        <div class="p-footer">
                            <div class="price-wrap">
                                <span style="font-size:0.8rem; color:var(--text-muted)">‚Ç∫</span>
                                <input type="number" class="price-inp" id="price-${p.id}" value="${p.price}">
                            </div>
                            <div class="action-btns">
                                <button class="icon-btn btn-pop ${popClass}" onclick="togglePopular('${p.id}', ${!p.isPopular})" title="Vitrine Ekle/√áƒ±kar">${popIcon}</button>
                                <button class="icon-btn btn-del" onclick="deleteProduct('${p.id}')">üóëÔ∏è</button>
                                <button class="btn-save" onclick="updatePrice('${p.id}')">Kaydet</button>
                            </div>
                        </div>
                    </div>`;
            });
        }

        function updatePrice(id) {
            const val = parseFloat(document.getElementById(`price-${id}`).value);
            const btn = event.target;
            btn.innerText = "‚è≥";
            db.collection("menu_items").doc(id).update({ price: val })
                .then(() => { btn.innerText = "‚úì"; setTimeout(() => { btn.innerText = "Kaydet"; }, 1000); });
        }

        // --- POP√úLERLƒ∞K DEƒûƒ∞≈ûTƒ∞RME ---
        function togglePopular(id, newStatus) {
            // Animasyon veya bekleme ikonu koyabiliriz ama basitlik i√ßin direkt g√ºncelleyelim
            db.collection("menu_items").doc(id).update({ isPopular: newStatus })
                .then(() => {
                    // Listeyi yenilemeden sadece butonu g√ºncellemek daha hƒ±zlƒ± olur ama
                    // array'i de g√ºncellememiz lazƒ±m. En temiz yol yeniden fetch.
                    fetchData();
                })
                .catch(err => alert("Hata: " + err));
        }

        function deleteProduct(id) {
            if(confirm("Bu √ºr√ºn√º kalƒ±cƒ± olarak silmek istediƒüinize emin misiniz?")) {
                db.collection("menu_items").doc(id).delete()
                    .then(() => { alert("√úr√ºn silindi."); fetchData(); })
                    .catch(err => alert("Hata: " + err));
            }
        }

        function searchProduct() { renderProducts(currentCategory); }

        function openModal() {
            const select = document.getElementById('newCatSelect');
            select.innerHTML = '<option value="">Se√ßiniz...</option>';
            categories.forEach(cat => {
                select.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
            select.innerHTML += '<option value="new">+ Yeni Kategori Olu≈ütur</option>';
            document.getElementById('addModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('addModal').style.display = 'none';
            document.getElementById('newCatSelect').value = "";
            document.getElementById('newCatInput').style.display = "none";
            document.getElementById('newCatInput').value = "";
            document.getElementById('newGroup').value = "";
            document.getElementById('newName').value = "";
            document.getElementById('newPrice').value = "";
            document.getElementById('newImg').value = "";
            document.getElementById('newPop').checked = false;
        }

        function checkNewCategory(elem) {
            const input = document.getElementById('newCatInput');
            if (elem.value === 'new') {
                input.style.display = 'block';
                input.focus();
            } else {
                input.style.display = 'none';
            }
        }

        function saveNewProduct() {
            const selectVal = document.getElementById('newCatSelect').value;
            let category = selectVal;
            if (selectVal === 'new') category = document.getElementById('newCatInput').value.trim();

            const group = document.getElementById('newGroup').value.trim();
            const name = document.getElementById('newName').value.trim();
            const price = parseFloat(document.getElementById('newPrice').value);
            const img = document.getElementById('newImg').value.trim();
            const isPop = document.getElementById('newPop').checked;

            if (!category || !group || !name || isNaN(price)) {
                alert("L√ºtfen t√ºm zorunlu alanlarƒ± doldurun!");
                return;
            }

            const btn = event.target;
            btn.innerText = "Kaydediliyor...";
            btn.disabled = true;

            const finalImg = img || 'default.png';

            db.collection("menu_items").add({
                category: category,
                group: group,
                name_tr: name,
                price: price,
                image: finalImg,
                name_en: name,
                isPopular: isPop
            }).then(() => {
                alert("‚úÖ √úr√ºn ba≈üarƒ±yla eklendi!");
                closeModal();
                fetchData(); 
                btn.innerText = "Kaydet";
                btn.disabled = false;
            }).catch((error) => {
                console.error("Hata:", error);
                alert("Hata olu≈ütu: " + error.message);
                btn.innerText = "Kaydet";
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
